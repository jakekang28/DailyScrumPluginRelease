<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>OAuth Setup Checker</title>
  <style>
    body {
      width: 500px;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .pass { background: #d4edda; border-color: #c3e6cb; }
    .fail { background: #f8d7da; border-color: #f5c6cb; }
    .info { background: #d1ecf1; border-color: #bee5eb; }
    .warn { background: #fff3cd; border-color: #ffeaa7; }
    h2 { margin-top: 0; }
    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
    button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #0056b3; }
    .steps {
      background: white;
      padding: 15px;
      border-radius: 5px;
      margin-top: 10px;
    }
    .steps ol { margin: 10px 0; padding-left: 20px; }
    .steps li { margin: 8px 0; }
  </style>
</head>
<body>
  <h1>ğŸ” OAuth Setup Checker</h1>

  <div id="extensionInfo" class="section info">
    <h2>ğŸ“‹ í˜„ì¬ Extension ì •ë³´</h2>
    <p><strong>Extension ID:</strong> <code id="extId">Loading...</code>
      <button onclick="copy('extId')">ë³µì‚¬</button>
    </p>
    <p><strong>Expected Redirect URI:</strong><br>
      <code id="redirectUri">Loading...</code>
      <button onclick="copy('redirectUri')">ë³µì‚¬</button>
    </p>
  </div>

  <div id="clientIdInfo" class="section info">
    <h2>ğŸ”‘ í˜„ì¬ OAuth í´ë¼ì´ì–¸íŠ¸ ID</h2>
    <p><code id="clientId">Loading...</code>
      <button onclick="copy('clientId')">ë³µì‚¬</button>
    </p>
  </div>

  <div class="section warn">
    <h2>âš ï¸ ì¤‘ìš”: Chrome Extension OAuth ì„¤ì •</h2>
    <p><strong>Chrome Extensionì€ ì›¹ ì•±ê³¼ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ OAuthë¥¼ ì„¤ì •í•©ë‹ˆë‹¤!</strong></p>

    <div class="steps">
      <h3>ì˜¬ë°”ë¥¸ ì„¤ì • ë°©ë²•:</h3>
      <ol>
        <li><strong>Google Cloud Console ì ‘ì†</strong>
          <br><a href="https://console.cloud.google.com/apis/credentials" target="_blank">
            https://console.cloud.google.com/apis/credentials
          </a>
        </li>

        <li><strong>ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë§Œë“¤ê¸°</strong>
          <br>â†’ "OAuth í´ë¼ì´ì–¸íŠ¸ ID" í´ë¦­
        </li>

        <li><strong>ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜• ì„ íƒ</strong>
          <br>âŒ "ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜" ì„ íƒí•˜ì§€ ë§ ê²ƒ!
          <br>âœ… <strong>"Chrome í™•ì¥ í”„ë¡œê·¸ë¨"</strong> ì„ íƒ
        </li>

        <li><strong>ì •ë³´ ì…ë ¥</strong>
          <br>ì´ë¦„: <code>Daily Scrum Extension</code>
          <br>í•­ëª© ID: <code id="extIdCopy">Loading...</code>
          <button onclick="copy('extIdCopy')">ë³µì‚¬</button>
        </li>

        <li><strong>ë§Œë“¤ê¸°</strong> í´ë¦­</li>

        <li><strong>ìƒì„±ëœ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ë³µì‚¬</strong>
          <br>í˜•ì‹: <code>XXXXXX.apps.googleusercontent.com</code>
        </li>

        <li><strong>lib/config.js ì—…ë°ì´íŠ¸</strong>
          <br>ìƒˆë¡œ ìƒì„±ëœ í´ë¼ì´ì–¸íŠ¸ IDë¡œ êµì²´
        </li>

        <li><strong>npm run build</strong> ì‹¤í–‰</li>

        <li><strong>í™•ì¥ í”„ë¡œê·¸ë¨ ìƒˆë¡œê³ ì¹¨</strong></li>
      </ol>
    </div>
  </div>

  <div class="section info">
    <h2>ğŸ” í˜„ì¬ ì„¤ì • í™•ì¸ ë°©ë²•</h2>
    <p>ê¸°ì¡´ í´ë¼ì´ì–¸íŠ¸ IDê°€ ì˜¬ë°”ë¥¸ íƒ€ì…ì¸ì§€ í™•ì¸:</p>
    <ol>
      <li>Google Cloud Console â†’ API ë° ì„œë¹„ìŠ¤ â†’ ì‚¬ìš©ì ì¸ì¦ ì •ë³´</li>
      <li>í˜„ì¬ í´ë¼ì´ì–¸íŠ¸ ID í´ë¦­</li>
      <li><strong>"ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜•"</strong> í™•ì¸:
        <ul>
          <li>âœ… <strong>"Chrome í™•ì¥ í”„ë¡œê·¸ë¨"</strong> â†’ ì˜¬ë°”ë¦„</li>
          <li>âŒ "ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜" â†’ ì˜ëª»ë¨ (ìƒˆë¡œ ìƒì„± í•„ìš”)</li>
        </ul>
      </li>
    </ol>
  </div>

  <div class="section warn">
    <h2>ğŸ“Œ ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜</h2>
    <ul>
      <li>âŒ "ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜"ìœ¼ë¡œ ìƒì„±í•˜ê³  Redirect URIë¥¼ ìˆ˜ë™ ì¶”ê°€
        <br>â†’ Chrome Extensionì—ì„œëŠ” ì‘ë™í•˜ì§€ ì•ŠìŒ!
      </li>
      <li>âŒ Extension IDë¥¼ ì˜ëª» ë³µì‚¬ (ê³µë°± í¬í•¨, ë¶ˆì™„ì „í•œ ID ë“±)</li>
      <li>âŒ Redirect URIë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•˜ë ¤ê³  ì‹œë„
        <br>â†’ "Chrome í™•ì¥ í”„ë¡œê·¸ë¨" íƒ€ì…ì€ ìë™ìœ¼ë¡œ ìƒì„±ë¨
      </li>
    </ul>
  </div>

  <div id="testButton" class="section info">
    <h2>ğŸ§ª OAuth í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testOAuth()">Google OAuth í”Œë¡œìš° í…ŒìŠ¤íŠ¸</button>
    <div id="testResult" style="margin-top:10px;"></div>
  </div>

  <script type="module">
    const extensionId = chrome.runtime.id;
    const redirectUri = `https://${extensionId}.chromiumapp.org/`;

    document.getElementById('extId').textContent = extensionId;
    document.getElementById('extIdCopy').textContent = extensionId;
    document.getElementById('redirectUri').textContent = redirectUri;

    // Load config
    import('../lib/config.js').then(config => {
      document.getElementById('clientId').textContent = config.GOOGLE_CLIENT_ID;
    }).catch(err => {
      document.getElementById('clientId').textContent = `Error: ${err.message}`;
    });

    window.copy = function(id) {
      const text = document.getElementById(id).textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      });
    };

    window.testOAuth = async function() {
      const resultDiv = document.getElementById('testResult');
      resultDiv.innerHTML = '<p>OAuth í”Œë¡œìš° ì‹œì‘ ì¤‘...</p>';

      try {
        const response = await chrome.runtime.sendMessage({
          action: 'AUTHORIZE_GOOGLE_WORKSPACE'
        });

        if (response.success) {
          resultDiv.innerHTML = '<div class="section pass"><strong>âœ… ì„±ê³µ!</strong><br>OAuth ì„¤ì •ì´ ì˜¬ë°”ë¦…ë‹ˆë‹¤.</div>';
        } else {
          resultDiv.innerHTML = `<div class="section fail"><strong>âŒ ì‹¤íŒ¨</strong><br>${response.error}</div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="section fail"><strong>âŒ ì—ëŸ¬</strong><br>${error.message}</div>`;
      }
    };
  </script>
</body>
</html>
